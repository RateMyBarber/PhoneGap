<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a4.1/jquery.mobile-1.0a4.1.min.css" />
<script src="http://code.jquery.com/jquery-1.5.2.min.js"></script>
<script src="http://code.jquery.com/mobile/1.0a4.1/jquery.mobile-1.0a4.1.min.js"></script>
<script src="phonegap.js"></script>
<script type="text/javascript" charset="utf-8">

    // Wait for PhoneGap to load
    // 
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }

    // PhoneGap is loaded and it is now safe to make calls PhoneGap methods
    //
    function onDeviceReady() {
        navigator.network.isReachable("phonegap.com", reachableCallback, {});
		navigator.geolocation.getCurrentPosition(onSuccess, onError);
    }
	
	var onSuccess = function(position) {		  
		$.getJSON('http://maps.googleapis.com/maps/api/geocode/json?latlng='+position.coords.latitude+','+position.coords.longitude+'&sensor=false', function(data) {
		  var items = [];
		  var state = '';
		  var city = '';
		  var city_bool = false;
		  var state_bool = false;
		  $.each(data, function(key, val) {
			  $.each(val, function(key2, val2) {
			  	$.each(val2, function(key3, val3) {
					if(key3 == 'address_components'){
			  			$.each(val3, function(key4, val4) {
			  				$.each(val4, function(key5, val5) {
								if(key5 == 'short_name'){
									if(city = '' && city_bool == false){
										city = val5;
									}
									if(state = '' && state_bool == false){
										state = val5;
									}
								}
								if(key5 == 'types'){
									if(val5 == 'sublocality'){
										city_bool = true;
									}
									if(val5 == 'administrative_area_level_1'){
										state_bool = true;
									}
								}
							});
						});
					};
			  	});
			  });
		  });
		});
		alert("City: " + city + " - State: " + state);
	};

	// onError Callback receives a PositionError object
	//
	function onError(error) {
	    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
	}

    // Check network status
    //
    function reachableCallback(reachability) {
        // There is no consistency on the format of reachability
        var networkState = reachability.code || reachability;

        var states = {};
        states[NetworkStatus.NOT_REACHABLE]                      = 'No network connection';
        states[NetworkStatus.REACHABLE_VIA_CARRIER_DATA_NETWORK] = 'Carrier data connection';
        states[NetworkStatus.REACHABLE_VIA_WIFI_NETWORK]         = 'WiFi connection';
		if(states[networkState] == 'No network connection'){
			window.location = 'nonetwork.html';
		}
    }
onLoad();
    </script>
</head>
<body>
    <div data-role="page" data-theme="b">
		<div data-role="header">
			<h1 id="jqm-logo"><img src="images/logo_new.png" width="140" /></h1> 
		</div>
		<div data-role="content">	
			<ul data-role="listview">
				<li><a href="">Barbershops Near Me <span class="ui-li-count">12</span></a></li>
			</ul>		
		</div>
	</div>
</body>
</html>